var $Utils=Utils.prototype,Game=function(e){this.init(e)};Game.prototype.init=function(e){var t=this;e=e||{},this.availableLeaders=[{id:"sterling",name:"Sterling",bio:""},{id:"gunter",name:"GÃ¼nter",bio:""},{id:"les",name:"Lesli",bio:""}],this.seasons=["Spring","Summer","Fall","Winter"],this.timer,this.hourCounter=1,this.dayCounter=1,this.seasonCounter=0,this.yearCounter=1,this.currentHour=1,this.currentDay=1,this.currentSeason=this.seasons[this.seasonCounter%4],this.isPlaying=0,this.timerInterval=1e3,this.isPopupVisible=0,this.hourlyEvents={},this.dailyEvents={},this.seasonalEvents={},this.yearlyEvents={},this.dailyMealsDesired=e.dailyMealsDesired||0,this.dailyMealsServed=e.dailyMealsServed||0,this.lowFoodDaysCount=e.lowFoodDaysCount||0,this.starvationMarkers=e.starvationMarkers||0,this.isGameOver=e.isGameOver||0,this.scheduledChildAgingEvents=e.scheduledChildAgingEvents||{7:1},this.scheduledAdultAgingEvents=e.scheduledAdultAgingEvents||{9:1,12:1,16:1},this.scheduledDeathEvents=e.scheduledAgingEvents||{22:1},this.availableSettlers=ko.observable($Utils.setDefaultValue(e.availableSettlers,5)),this.workingSettlers=ko.observable(e.workingSettlers||0),this.busySettlers=ko.observable(e.busySettlers||0),this.childSettlers=ko.observable($Utils.setDefaultValue(e.childSettlers,1)),this.adultSettlers=ko.observable($Utils.setDefaultValue(e.adultSettlers,1)),this.oldSettlers=ko.observable($Utils.setDefaultValue(e.oldSettlers,1)),this.resources=ko.observable(e.resources||this._getDefaultResources()),this.playSpeed=ko.observable(1),this.totalSettlers=ko.computed(function(){return(t.availableSettlers()||0)+(t.workingSettlers()||0)+(t.busySettlers()||0)}),document.getElementById("current-hour").innerHTML=this.currentHour,document.getElementById("current-day").innerHTML=this.currentDay,document.getElementById("current-season").innerHTML=this.currentSeason,document.getElementById("current-year").innerHTML=this.yearCounter,this._setupDefaultTimeEvents(),this.somePerson=new Person({name:"Bob"}),this.someSettler=new Settler({name:"Jeff",tribe:"Umpqua"})},Game.prototype.mainLoop=function(){this.currentHour,this.currentDay,this.currentSeasonIdx;this.hourCounter++,this.currentHour=this.hourCounter%24,document.getElementById("current-hour").innerHTML=this.currentHour,this.processHourlyEvents(),0==this.currentHour&&(this.dayCounter++,this.currentDay=this.dayCounter%30,document.getElementById("current-day").innerHTML=this.currentDay,this.processDailyEvents(),0==this.currentDay&&(this.seasonCounter++,this.currentSeasonIdx=this.seasonCounter%4,this.currentSeason=this.seasons[this.currentSeasonIdx],document.getElementById("current-season").innerHTML=this.currentSeason,this.processSeasonalEvents(),0==this.currentSeasonIdx&&(this.yearCounter++,document.getElementById("current-year").innerHTML=this.yearCounter,this.processYearlyEvents())))},Game.prototype.processHourlyEvents=function(){var e=this.hourlyEvents[this.currentHour];void 0!=e&&$.each(e,function(e,t){game[t]()})},Game.prototype.processDailyEvents=function(){var e=this.dailyEvents[this.currentDay];void 0!=e&&$.each(e,function(e,t){game[t]()}),this._doDailyStarvationCalculation(),this.dailyMealsDesired=0,this.dailyMealsServed=0},Game.prototype.processSeasonalEvents=function(){var e=this.seasonalEvents[this.seasonCounter];void 0!=e&&$.each(e,function(e,t){game[t]()}),this.doChildAgingEventCheck(),this.doAdultAgingEventCheck(),this.doDeathEventCheck()},Game.prototype.processYearlyEvents=function(){},Game.prototype._doDailyStarvationCalculation=function(){this.dailyMealsServed/this.dailyMealsDesired<.6?(this.starvationMarkers++,this.starvationMarkers>10&&(this.starvationMarkers=10),console.log("Starvation markers: "+this.starvationMarkers)):(this.starvationMarkers-=2,this.starvationMarkers<0&&(this.starvationMarkers=0),console.log("Starvation markers: "+this.starvationMarkers)),this.starvationMarkers>3&&this.processStarvationEvent()},Game.prototype.consumeFoodEvent=function(){var e=this.resources().food,t=this.totalSettlers();this.dailyMealsDesired+=t;var s=e-t,i=0>s?t+s:t;this.dailyMealsServed+=i,this._updateObservableProp(this.resources,{food:e-i}),console.log("Food leftover after serving: "+this.resources().food)},Game.prototype.doChildAgingEventCheck=function(){void 0!=this.scheduledChildAgingEvents[this.seasonCounter]&&this.ageChildren(this.scheduledChildAgingEvents[this.seasonCounter])},Game.prototype.doAdultAgingEventCheck=function(){void 0!=this.scheduledAdultAgingEvents[this.seasonCounter]&&this.ageAdults(this.scheduledAdultAgingEvents[this.seasonCounter])},Game.prototype.doDeathEventCheck=function(){void 0!=this.scheduledDeathEvents[this.seasonCounter]&&this.killOldAdults(this.scheduledDeathEvents[this.seasonCounter])},Game.prototype.ageChildren=function(e){for(var t=0;e>t;t++){var s=4*$Utils.doRand(40,51),i=this.seasonCounter+s;this.scheduledAdultAgingEvents[i]=(this.scheduledAdultAgingEvents[i]||0)+1}},Game.prototype.ageAdults=function(e){for(var t=0;e>t;t++){var s=4*$Utils.doRand(10,21),i=this.seasonCounter+s;this.scheduledDeathEvents[i]=(this.scheduledDeathEvents[i]||0)+1}},Game.prototype.killOldAdults=function(e){for(var t=0;e>t;t++)this.availableSettlers()>0?(this.availableSettlers(this.availableSettlers()-1),console.log("A settler has died of old age. Num left: "+this.totalSettlers())):this.workingSettlers()>0?(this.workingSettlers(this.workingSettlers()-1),console.log("A settler has died of old age. Num left: "+this.totalSettlers())):this.busySettlers()>0&&(this.busySettlers(this.busySettlers()-1),console.log("A settler has died of old age. Num left: "+this.totalSettlers())),0==this.availableSettlers()&&0==this.workingSettlers()&&0==this.busySettlers()&&this.gameOver()},Game.prototype.processStarvationEvent=function(){var e=$Utils.doRand(1,11);e<=this.starvationMarkers&&(this.availableSettlers()>0?(this.availableSettlers(this.availableSettlers()-1),console.log("A settler has died. Num left: "+this.totalSettlers())):this.workingSettlers()>0?(this.workingSettlers(this.workingSettlers()-1),console.log("A settler has died. Num left: "+this.totalSettlers())):this.busySettlers()>0&&(this.busySettlers(this.busySettlers()-1),console.log("A settler has died. Num left: "+this.totalSettlers())),0==this.totalSettlers()&&this.gameOver())},Game.prototype.startMainTimer=function(){var e=this;this.timer=setInterval(function(){e.mainLoop()},this.timerInterval)},Game.prototype.pauseMainTimer=function(){clearInterval(this.timer)},Game.prototype.restartMainTimer=function(){this.pauseMainTimer(),this.startMainTimer()},Game.prototype.spcAction=function(){this.isPopupVisible||(this.isPlaying?this.pauseMainTimer():this.isGameOver||this.startMainTimer(),this.isPlaying=!this.isPlaying)},Game.prototype.plusAction=function(){4!=this.playSpeed()&&(this.playSpeed(this.playSpeed()+1),this._setIntervalBasedOnPlaySpeedInteger(),this.isPlaying&&this.restartMainTimer())},Game.prototype.minusAction=function(){1!=this.playSpeed()&&(this.playSpeed(this.playSpeed()-1),this._setIntervalBasedOnPlaySpeedInteger(),this.isPlaying&&this.restartMainTimer())},Game.prototype._setIntervalBasedOnPlaySpeedInteger=function(){1==this.playSpeed()?this.timerInterval=1e3:2==this.playSpeed()?this.timerInterval=500:3==this.playSpeed()?this.timerInterval=250:4==this.playSpeed()&&(this.timerInterval=100)},Game.prototype._updateObservableProp=function(e,t,s,i){if(!ko.isObservable(e))return console.log("_updateObservableProp requires an observable as its first argument"),!1;s=$Utils.setDefaultValue(s,0),i=$Utils.setDefaultValue(i,1);var o=e(),n=[];for(existingProp in o)void 0!=t[existingProp]?(o[existingProp]=t[existingProp],delete t[existingProp]):n.push(existingProp);if(s&&$.each(n,function(e,t){delete o[t]}),i)for(newProp in t)o[newProp]=t[newProp];e(o)},Game.prototype._hideOneElemAndShowAnother=function(e,t,s,i,o){var n=new Promise(function(n){e=e instanceof jQuery?e:$(e),t=t instanceof jQuery?t:$(t),s=void 0!=s?s:300,i=void 0!=i?i:300,e.fadeOut(s,function(){o&&"function"==typeof o&&o(),t.fadeIn(i,function(){n()})})});return n},Game.prototype.revealText=function(e,t,s){var i=new Promise(function(i){e=e instanceof jQuery?e:$(e),t=void 0!=t?t:2e3,s=s||0;var o=e.css("position");e.css("position","relative");var n=$("<div></div>").css({position:"absolute",top:"0px",left:"-10%",width:"110%",height:"100%"}).addClass("white-gradient-with-transparency").appendTo(e);e.show(),n.hide("slide",{direction:"right",easing:"linear"},t,function(){n.remove(),e.css("position",o),setTimeout(function(){i()},s)})});return i},Game.prototype.gameOver=function(){console.log("No settlers left."),this.pauseMainTimer(),this.isGameOver=1},Game.prototype.newGame=function(){var e=this;this._hideOneElemAndShowAnother("#newgame-content","#intro-content",300,300).then(function(){return e.revealText("#intro-s1-p1",3e3,1e3)}).then(function(){return e.revealText("#intro-s1-p2",3e3,1e3)}).then(function(){return e.revealText("#intro-s1-p3",3e3,1e3)}).then(function(){$("#intro-s1-buttons").fadeIn(500)})},Game.prototype._setupDefaultTimeEvents=function(){var e=this;$.each([7,12,18],function(t,s){e.hourlyEvents[s]=$Utils.pushOntoArray(e.hourlyEvents[s],"consumeFoodEvent")})},Game.prototype._getDefaultResources=function(){return{food:105}},Game.prototype.hideModal=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.showModalClose=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.modalWindowTitle=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.modalWindowText=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.showModalWindowFooter=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.loadGame=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.saveGame=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.logMessages=function(){console.log("NOT IMPLEMENTED YET")},Game.prototype.showFaq=function(){console.log("NOT IMPLEMENTED YET")};